# 🌐 WebDAV云备份功能使用指南

## 📋 功能概述

WebDAV云备份功能允许您将IP纯净度检查工具的配置数据备份到您自己的WebDAV兼容云存储服务中，实现真正的私有云备份和跨设备同步。

### 🎯 主要优势
- **完全私有**: 数据存储在您自己的云服务器上
- **跨设备同步**: 在任何设备上访问您的配置
- **版本管理**: 自动保留多个备份版本
- **标准协议**: 兼容所有标准WebDAV服务

### 🌐 支持的WebDAV服务
- **Nextcloud** - 开源私有云平台
- **ownCloud** - 企业级文件同步平台
- **Synology NAS** - 群晖网络存储
- **QNAP NAS** - 威联通网络存储
- **Apache HTTP Server** - 带WebDAV模块
- **nginx** - 带WebDAV模块
- **其他标准WebDAV服务**

## 🚀 快速开始

### 1. 配置WebDAV服务器信息

1. 访问"设置"页面，找到"WebDAV云备份"区域
2. 填写WebDAV配置信息：
   - **服务器URL**: 您的WebDAV服务器地址
   - **用户名**: WebDAV账户用户名
   - **密码**: WebDAV账户密码（建议使用应用专用密码）
   - **备份路径**: 配置文件存储目录

### 2. 测试连接

1. 填写完配置信息后，点击"🔍 测试连接"
2. 系统会验证WebDAV服务器连接和权限
3. 连接成功后，点击"💾 保存配置"

### 3. 备份和恢复

**备份配置**:
- 点击"☁️ 备份到WebDAV"将当前配置上传

**恢复配置**:
- 点击"📥 从WebDAV恢复"下载最新配置

**查看备份**:
- 点击"📋 查看备份"列出所有备份文件

## 🔧 详细配置说明

### WebDAV服务器URL格式

不同服务的URL格式示例：

#### Nextcloud
```
https://your-nextcloud.com/remote.php/dav/files/username/
```

#### ownCloud
```
https://your-owncloud.com/remote.php/webdav/
```

#### Synology NAS
```
https://your-nas.com:5006/webdav/
```

#### QNAP NAS
```
https://your-qnap.com:443/webdav/
```

### 认证配置

#### 应用专用密码（推荐）
大多数现代WebDAV服务支持应用专用密码：

1. 登录您的云服务管理界面
2. 进入安全设置或应用密码页面
3. 创建新的应用专用密码
4. 使用该密码而非主账户密码

#### 基本认证
如果服务不支持应用专用密码，可以使用主账户密码，但需要确保：
- 使用HTTPS连接
- 账户有WebDAV访问权限

### 备份路径配置

- **默认路径**: `ip-purity-checker/`
- **自定义路径**: 可以设置任意目录名
- **路径格式**: 支持多级目录，如 `backups/ip-checker/`
- **自动创建**: 系统会自动创建不存在的目录

## 📁 备份文件格式

### 文件命名规则
```
ip-purity-config-YYYY-MM-DDTHH-MM-SS-sssZ.json
```

示例：
```
ip-purity-config-2024-01-15T10-30-45-123Z.json
```

### 文件内容结构
```json
{
  "subscriptions": [...],
  "apiKeysManager": {...},
  "settings": {...},
  "backupTime": "2024-01-15T10:30:45.123Z",
  "version": "2.0"
}
```

## 🔒 安全最佳实践

### 1. 连接安全
- ✅ 始终使用HTTPS连接
- ✅ 验证SSL证书有效性
- ✅ 使用强密码或应用专用密码
- ❌ 避免在公共网络上传输敏感数据

### 2. 访问控制
- ✅ 为WebDAV创建专用账户
- ✅ 限制账户权限到最小必要范围
- ✅ 定期更换密码
- ✅ 启用双因素认证（如果支持）

### 3. 数据保护
- ✅ 定期备份重要配置
- ✅ 保留多个版本的备份
- ✅ 定期清理过期备份
- ✅ 监控异常访问活动

## 🛠️ 故障排除

### 常见问题

#### 1. "连接失败：认证失败"
**原因**: 用户名或密码错误
**解决方案**:
- 检查用户名和密码是否正确
- 尝试使用应用专用密码
- 确认账户有WebDAV访问权限

#### 2. "WebDAV路径不存在"
**原因**: URL路径配置错误
**解决方案**:
- 检查WebDAV服务器URL格式
- 确认路径中的用户名正确
- 尝试在浏览器中访问WebDAV URL

#### 3. "上传失败：权限不足"
**原因**: 账户没有写入权限
**解决方案**:
- 检查账户权限设置
- 确认目标目录可写
- 联系管理员分配适当权限

#### 4. "获取文件列表失败"
**原因**: 服务器不支持PROPFIND方法
**解决方案**:
- 确认WebDAV服务器配置正确
- 检查服务器是否启用WebDAV模块
- 尝试使用不同的WebDAV客户端测试

### 调试步骤

1. **验证基本连接**:
   ```bash
   curl -X PROPFIND https://your-webdav-server/ \
        -u username:password \
        -H "Depth: 0"
   ```

2. **测试文件上传**:
   ```bash
   curl -X PUT https://your-webdav-server/test.txt \
        -u username:password \
        -d "test content"
   ```

3. **检查服务器日志**:
   - 查看WebDAV服务器的访问日志
   - 检查错误日志中的详细信息

## 📊 使用场景

### 场景1: 个人多设备同步
1. 在主设备上配置订阅和API密钥
2. 备份配置到个人Nextcloud
3. 在其他设备上恢复配置
4. 享受无缝的多设备体验

### 场景2: 团队配置共享
1. 管理员配置标准的订阅和API密钥
2. 备份到团队共享的WebDAV服务器
3. 团队成员从共享位置恢复配置
4. 确保团队使用统一配置

### 场景3: 配置版本管理
1. 在重大配置变更前备份
2. 保留多个版本的配置文件
3. 出现问题时快速回滚
4. 追踪配置变更历史

## 🔄 与其他备份方式对比

| 特性 | WebDAV备份 | Cloudflare KV | 本地导出 |
|------|------------|---------------|----------|
| 数据控制 | ✅ 完全私有 | ⚠️ 第三方服务 | ✅ 本地控制 |
| 跨设备同步 | ✅ 自动同步 | ✅ 自动同步 | ❌ 手动传输 |
| 版本管理 | ✅ 多版本 | ⚠️ 单版本 | ✅ 手动管理 |
| 设置复杂度 | ⚠️ 需要配置 | ✅ 简单 | ✅ 简单 |
| 存储成本 | ✅ 自有服务器 | ⚠️ 可能收费 | ✅ 免费 |

## 🎯 最佳实践建议

1. **定期备份**: 建议每周至少备份一次重要配置
2. **多重备份**: 同时使用WebDAV和本地导出作为双重保障
3. **测试恢复**: 定期测试备份恢复流程确保可用性
4. **监控空间**: 定期清理旧备份文件避免存储空间不足
5. **安全审计**: 定期检查WebDAV访问日志确保安全

---

**WebDAV云备份功能为您提供了完全私有、安全可控的配置同步解决方案！** 🎉
